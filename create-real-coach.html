<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Cr√©er Coach R√©el avec Auth</title>
    <style>
        body {
            font-family: system-ui;
            background: #111;
            color: #f5f5f7;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .card {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        button {
            background: #ffcc00;
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .success { background: #006600; }
        .error { background: #660000; }
        .log {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-line;
            max-height: 400px;
            overflow-y: auto;
        }
        input {
            background: #333;
            color: #f5f5f7;
            border: 1px solid #555;
            padding: 10px;
            border-radius: 4px;
            width: 100%;
            margin: 8px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Cr√©er un Coach R√©el avec Authentification</h1>

        <div class="card">
            <h2>üìù Informations du Coach</h2>
            <label>Email du coach :</label>
            <input type="email" id="coachEmail" value="coach.test@prodtalent.fr" placeholder="coach.test@prodtalent.fr">

            <label>Nom du coach :</label>
            <input type="text" id="coachName" value="Coach Test NY" placeholder="Coach Test">

            <label>Mot de passe :</label>
            <input type="password" id="coachPassword" value="test123" placeholder="test123">

            <label>Timezone :</label>
            <select id="coachTimezone" style="background: #333; color: #f5f5f7; border: 1px solid #555; padding: 10px; border-radius: 4px; width: 100%; margin: 8px 0;">
                <option value="America/New_York">America/New_York (pour tests timezone)</option>
                <option value="Europe/Paris">Europe/Paris</option>
                <option value="Europe/Zurich">Europe/Zurich</option>
                <option value="America/Toronto">America/Toronto</option>
            </select>

            <br><br>
            <button onclick="createRealCoach()" id="createBtn">üöÄ Cr√©er Coach + Disponibilit√©s</button>
        </div>

        <div class="card">
            <h2>üìä R√©sultats</h2>
            <div id="result" class="log">Cliquez sur le bouton pour cr√©er le coach...</div>
        </div>

        <div class="card">
            <h2>üîó Liens Utiles</h2>
            <p><strong>Connexion Coach :</strong> <a href="/login/coach" style="color: #ffcc00;">http://127.0.0.1:5173/login/coach</a></p>
            <p><strong>Dashboard Coach :</strong> <a href="/dashboard/coach" style="color: #ffcc00;">http://127.0.0.1:5173/dashboard/coach</a></p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
        import { getFirestore, doc, setDoc, collection, addDoc, Timestamp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

        // Configuration Firebase (votre vraie config)
        const firebaseConfig = {
            apiKey: "AIzaSyDiUUZ8T_gTAp7LdqPNnuFl9U7Gl7Ecfik",
            authDomain: "talents-tech-senegal.firebaseapp.com",
            projectId: "talents-tech-senegal",
            storageBucket: "talents-tech-senegal.firebasestorage.app",
            messagingSenderId: "759306069327",
            appId: "1:759306069327:web:f711a2b907537e9dead13a",
            measurementId: "G-0KNNCCGGEJ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.createRealCoach = async function() {
            const btn = document.getElementById('createBtn');
            const result = document.getElementById('result');

            btn.disabled = true;
            btn.textContent = '‚è≥ Cr√©ation en cours...';
            result.textContent = 'üîÑ D√©marrage de la cr√©ation du coach...\n';

            try {
                const email = document.getElementById('coachEmail').value;
                const name = document.getElementById('coachName').value;
                const password = document.getElementById('coachPassword').value;
                const timezone = document.getElementById('coachTimezone').value;

                result.textContent += `üìß Email: ${email}\n`;
                result.textContent += `üë§ Nom: ${name}\n`;
                result.textContent += `üåç Timezone: ${timezone}\n\n`;

                // √âtape 1: Cr√©er l'utilisateur avec authentication
                result.textContent += '1Ô∏è‚É£ Cr√©ation du compte avec authentification Firebase...\n';
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                result.textContent += `‚úÖ Utilisateur cr√©√© avec UID: ${user.uid}\n\n`;

                // √âtape 2: Cr√©er le profil coach dans Firestore
                result.textContent += '2Ô∏è‚É£ Cr√©ation du profil coach dans Firestore...\n';
                const coachProfile = {
                    id: user.uid,
                    email: email,
                    displayName: name,
                    role: 'coach',
                    bio: `Coach sp√©cialis√© en d√©veloppement de carri√®re - ${timezone}`,
                    skills: 'Coaching carri√®re, Entretiens, CV, N√©gociation salaire',
                    timezone: timezone,
                    createdAt: Timestamp.now(),
                    updatedAt: Timestamp.now()
                };

                await setDoc(doc(db, 'Users', user.uid), coachProfile);
                result.textContent += `‚úÖ Profil coach sauvegard√©\n\n`;

                // √âtape 3: Cr√©er des disponibilit√©s
                result.textContent += '3Ô∏è‚É£ Cr√©ation des disponibilit√©s pour les 7 prochains jours...\n';

                const today = new Date();
                const timeSlots = ['09:00', '10:00', '11:00', '13:00', '14:00', '15:00', '16:00'];

                for (let i = 1; i <= 7; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() + i);

                    // Exclure les weekends
                    if (date.getDay() !== 0 && date.getDay() !== 6) {
                        const year = date.getFullYear();
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const day = String(date.getDate()).padStart(2, '0');
                        const dateStr = `${year}-${month}-${day}`;

                        const availabilityData = {
                            coachId: user.uid,
                            date: dateStr,
                            timeSlots: timeSlots,
                            timezone: timezone,
                            createdAt: Timestamp.now(),
                            updatedAt: Timestamp.now()
                        };

                        await setDoc(doc(db, 'CoachAvailabilities', `${user.uid}_${dateStr}`), availabilityData);
                        result.textContent += `üìÖ Disponibilit√©s cr√©√©es pour ${dateStr} (${timeSlots.length} cr√©neaux)\n`;
                    }
                }

                result.textContent += '\nüéâ SUCC√àS ! Coach cr√©√© avec succ√®s !\n\n';
                result.textContent += 'üîó Informations de connexion :\n';
                result.textContent += `   üìß Email: ${email}\n`;
                result.textContent += `   üîë Mot de passe: ${password}\n`;
                result.textContent += `   üåç Timezone: ${timezone}\n\n`;
                result.textContent += 'üè† Acc√®s au dashboard :\n';
                result.textContent += '   1. Allez sur http://127.0.0.1:5173/login/coach\n';
                result.textContent += '   2. Connectez-vous avec les infos ci-dessus\n';
                result.textContent += '   3. Dashboard automatiquement accessible\n\n';
                result.textContent += '‚úÖ Le coach peut maintenant recevoir des r√©servations !';

                result.className = 'log success';

            } catch (error) {
                console.error('Erreur:', error);
                result.textContent += `\n‚ùå ERREUR: ${error.message}\n`;
                result.textContent += '\nüí° Si l\'email existe d√©j√†, essayez un autre email.';
                result.className = 'log error';
            } finally {
                btn.disabled = false;
                btn.textContent = 'üöÄ Cr√©er Coach + Disponibilit√©s';
            }
        };
    </script>
</body>
</html>